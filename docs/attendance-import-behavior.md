# 考勤导入与回滚策略说明

日期：2026-02-04

## 导入默认策略
- **默认模式：`override`**
  - 同一用户 + 同一日期再次导入时，覆盖已有记录。
  - 覆盖后会更新 `source_batch_id` 为最新批次。

## 可选模式
- `merge`：仅合并打卡时间与部分指标（适用于补录/增量）
- 通过导入 payload 的 `mode` 字段指定：
  ```json
  { "mode": "merge" }
  ```

## 回滚策略
- 接口：`POST /api/attendance/import/rollback/:id`
- 回滚逻辑：删除 `source_batch_id = 批次ID` 的记录。
- **注意**：若后续批次覆盖了旧记录，回滚旧批次不会恢复被覆盖的数据。

## 异常/审批策略（试点阶段）
- **当前：只输出 warnings / reasons**
- 不自动触发或回写审批（降低试点复杂度）
- 后续可接钉钉审批自动回写（高级阶段）

