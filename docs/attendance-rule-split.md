# 考勤规则拆分（默认规则 vs 用户可配置）

日期：2026-02-04

## 背景
试点范围：**考勤组**  
数据入口：**CSV（钉钉日汇总）**  
规则策略：**默认规则 + 用户可配置**

本文件基于 `/Users/huazhou/Downloads/新建 文本文档 (2)(1).txt` 中的清洗逻辑抽取，结合当前系统能力，给出可落地的规则拆分与建议。

---

## 一、默认规则（系统内置，优先保障可用性）
以下规则当前系统已覆盖，建议作为 **默认开启**：

### 1) 标准异常提醒（通用）
- 迟到/早退提醒（`clockIn1_after` / `clockOut1_before`）
- 缺卡提醒（上班/下班缺卡）
- 补卡未找到上班2打卡提醒

### 2) 休息日与加班提醒
- 休息日打卡无加班单提醒
- 下班晚但无加班单提醒
- 有加班单但未打卡提醒

### 3) 出差/请假冲突提醒
- 出差 + 事假/病假/工伤假 同时存在提醒
- 出差当天实际工时不足 8 小时提醒
- 请假当天实际工时不足 8 小时提醒

### 4) 角色/考勤组默认规则
- 保安：节假日打卡计入加班（默认模板已有）
- 司机：休息日打卡计入加班（默认模板已有）
- 单休车间：休息日出差默认 8 小时、休息日打卡无加班单提醒

### 5) 节假日首日/天数补贴
- 统一使用全局节假日策略（`holidayPolicy`）
- 通过 `holidayPolicy.overrides` 配置“按考勤组/角色/人员/天数”补贴

---

## 二、用户可配置规则（可编辑模板）
以下规则建议放入 **用户自定义模板**（适用于各考勤组差异）：

### 1) 请假与打卡矛盾提醒
- 请假但所有打卡均存在（需要人工核对）
- 请假 + 加班同时存在（提醒核对）

### 2) 特定班次/考勤组提醒
- 单休车间：请假但正常打卡提醒
- 休息日打卡但缺少下班卡提醒

### 3) 春节特殊补贴
（已通过 holiday override 实现，仍建议开放给业务调整）
- 工段长/单休办公/管理岗补贴 6 天或 8 天
- 保安/仓储/车间按实际出勤

---

## 三、需要二次开发支持的规则（后续阶段）
以下规则需要新引擎能力或跨日逻辑支持：

1. **通宵加班/跨日处理**
   - “前一日加班 ≥ 16 小时，次日打卡需特殊处理”
   - “下班卡被识别为上班卡，需要跨日纠正”

2. **跨月计薪周期**
   - 月度结算周期不是自然月（如 1/26–2/6）

3. **审批回写/多流程校验**
   - 撤销流程（REVOKE）与重复审批处理

---

## 建议落地方式
1) **默认规则**：保持系统模板启用即可  
2) **用户自定义**：用自定义模板存放（见 `docs/attendance-rule-template-custom.json`）  
3) **节假日补贴**：统一放到 `holidayPolicy.overrides` 里维护  

