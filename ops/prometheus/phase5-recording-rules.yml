groups:
  - name: phase5_recording
    interval: 1m
    rules:
      - record: metasheet:http_success_rate:5m
        expr: sum(rate(http_requests_total{status=~"2.."}[5m])) / sum(rate(http_requests_total[5m]))
      - record: metasheet:cache_hit_rate:10m
        expr: sum(rate(cache_hits_total[10m])) / (sum(rate(cache_hits_total[10m])) + sum(rate(cache_miss_total[10m])))
      - record: metasheet:fallback_effective_ratio:10m
        expr: sum(rate(metasheet_fallback_effective_total[10m])) / sum(rate(metasheet_fallback_total[10m]))
      - record: metasheet:plugin_reload_p95:5m
        expr: histogram_quantile(0.95, sum(rate(metasheet_plugin_reload_duration_seconds_bucket[5m])) by (le))
      - record: metasheet:plugin_reload_p99:5m
        expr: histogram_quantile(0.99, sum(rate(metasheet_plugin_reload_duration_seconds_bucket[5m])) by (le))
      - record: metasheet:snapshot_op_p95:5m
        expr: histogram_quantile(0.95, sum(rate(metasheet_snapshot_operation_duration_seconds_bucket[5m])) by (operation, le))
      - record: metasheet:snapshot_op_p99:5m
        expr: histogram_quantile(0.99, sum(rate(metasheet_snapshot_operation_duration_seconds_bucket[5m])) by (operation, le))
