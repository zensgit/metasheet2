openapi: 3.0.3
info:
  title: Metasheet v2 API
  version: 0.1.0
servers:
  - url: http://localhost:8900
components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
  schemas:
    StandardResponse:
      type: object
      properties:
        ok:
          type: boolean
        data:
          nullable: true
    ErrorResponse:
      type: object
      properties:
        ok:
          type: boolean
          default: false
        error:
          type: object
          properties:
            code:
              type: string
            message:
              type: string
    User:
      type: object
      properties:
        id:
          type: string
        email:
          type: string
        name:
          type: string
        roles:
          type: array
          items:
            type: string
        perms:
          type: array
          items:
            type: string
    Permission:
      type: object
      properties:
        code:
          type: string
        name:
          type: string
        description:
          type: string
          nullable: true
        created_at:
          type: string
          format: date-time
    Role:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        permissions:
          type: array
          items:
            type: string
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
    Comment:
      type: object
      properties:
        id:
          type: string
        spreadsheetId:
          type: string
        rowId:
          type: string
        fieldId:
          type: string
          nullable: true
        content:
          type: string
        authorId:
          type: string
        parentId:
          type: string
          nullable: true
        resolved:
          type: boolean
        createdAt:
          type: string
        updatedAt:
          type: string
        mentions:
          type: array
          items:
            type: string
    CommentsListResponse:
      type: object
      properties:
        ok:
          type: boolean
          example: true
        data:
          type: object
          properties:
            items:
              type: array
              items:
                $ref: '#/components/schemas/Comment'
            total:
              type: integer
              example: 1
            limit:
              type: integer
              example: 50
            offset:
              type: integer
              example: 0
    PluginAdminEntry:
      type: object
      properties:
        name:
          type: string
        displayName:
          type: string
          nullable: true
        description:
          type: string
          nullable: true
        version:
          type: string
          nullable: true
        author:
          type: string
          nullable: true
        status:
          type: string
          enum:
            - active
            - inactive
            - failed
        error:
          type: string
          nullable: true
        lastAttempt:
          type: string
          nullable: true
        registryStatus:
          type: string
          nullable: true
        lastActivated:
          type: string
          nullable: true
    PluginConfigEntry:
      type: object
      properties:
        config:
          type: object
        schema:
          type: object
          nullable: true
        version:
          type: string
          nullable: true
        last_modified:
          type: string
          nullable: true
        modified_by:
          type: string
          nullable: true
    AttendanceEvent:
      type: object
      properties:
        id:
          type: string
        user_id:
          type: string
        org_id:
          type: string
        work_date:
          type: string
          format: date
        occurred_at:
          type: string
          format: date-time
        event_type:
          type: string
          enum:
            - check_in
            - check_out
            - adjustment
        source:
          type: string
        timezone:
          type: string
        location:
          type: object
        meta:
          type: object
        created_at:
          type: string
          format: date-time
    AttendanceRecord:
      type: object
      properties:
        id:
          type: string
        user_id:
          type: string
        org_id:
          type: string
        work_date:
          type: string
          format: date
        timezone:
          type: string
        first_in_at:
          type: string
          format: date-time
          nullable: true
        last_out_at:
          type: string
          format: date-time
          nullable: true
        work_minutes:
          type: integer
        late_minutes:
          type: integer
        early_leave_minutes:
          type: integer
        status:
          type: string
        is_workday:
          type: boolean
        meta:
          type: object
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
    AttendanceRequest:
      type: object
      properties:
        id:
          type: string
        user_id:
          type: string
        org_id:
          type: string
        work_date:
          type: string
          format: date
        request_type:
          type: string
          enum:
            - missed_check_in
            - missed_check_out
            - time_correction
            - leave
            - overtime
        requested_in_at:
          type: string
          format: date-time
          nullable: true
        requested_out_at:
          type: string
          format: date-time
          nullable: true
        reason:
          type: string
          nullable: true
        status:
          type: string
          enum:
            - pending
            - approved
            - rejected
            - cancelled
        approval_instance_id:
          type: string
          nullable: true
        resolved_by:
          type: string
          nullable: true
        resolved_at:
          type: string
          format: date-time
          nullable: true
        metadata:
          type: object
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
    AttendanceLeaveType:
      type: object
      properties:
        id:
          type: string
        orgId:
          type: string
        code:
          type: string
        name:
          type: string
        requiresApproval:
          type: boolean
        requiresAttachment:
          type: boolean
        defaultMinutesPerDay:
          type: integer
        isActive:
          type: boolean
    AttendanceOvertimeRule:
      type: object
      properties:
        id:
          type: string
        orgId:
          type: string
        name:
          type: string
        minMinutes:
          type: integer
        roundingMinutes:
          type: integer
        maxMinutesPerDay:
          type: integer
        requiresApproval:
          type: boolean
        isActive:
          type: boolean
    AttendanceApprovalStep:
      type: object
      properties:
        name:
          type: string
        approverUserIds:
          type: array
          items:
            type: string
        approverRoleIds:
          type: array
          items:
            type: string
    AttendanceApprovalFlow:
      type: object
      properties:
        id:
          type: string
        orgId:
          type: string
        name:
          type: string
        requestType:
          type: string
        steps:
          type: array
          items:
            $ref: '#/components/schemas/AttendanceApprovalStep'
        isActive:
          type: boolean
    AttendanceRotationRule:
      type: object
      properties:
        id:
          type: string
        orgId:
          type: string
        name:
          type: string
        timezone:
          type: string
        shiftSequence:
          type: array
          items:
            type: string
        isActive:
          type: boolean
    AttendanceRotationAssignment:
      type: object
      properties:
        id:
          type: string
        orgId:
          type: string
        userId:
          type: string
        rotationRuleId:
          type: string
        startDate:
          type: string
          format: date
        endDate:
          type: string
          format: date
          nullable: true
        isActive:
          type: boolean
    AttendanceRotationAssignmentItem:
      type: object
      properties:
        assignment:
          $ref: '#/components/schemas/AttendanceRotationAssignment'
        rotation:
          $ref: '#/components/schemas/AttendanceRotationRule'
    AttendanceRequestReportItem:
      type: object
      properties:
        requestType:
          type: string
        status:
          type: string
        total:
          type: integer
        minutes:
          type: integer
    AttendanceSummary:
      type: object
      properties:
        total_days:
          type: integer
        total_minutes:
          type: integer
        normal_days:
          type: integer
        late_days:
          type: integer
        early_leave_days:
          type: integer
        late_early_days:
          type: integer
        partial_days:
          type: integer
        absent_days:
          type: integer
        adjusted_days:
          type: integer
        off_days:
          type: integer
    AttendanceRule:
      type: object
      properties:
        id:
          type: string
        orgId:
          type: string
        name:
          type: string
        timezone:
          type: string
        workStartTime:
          type: string
        workEndTime:
          type: string
        lateGraceMinutes:
          type: integer
        earlyGraceMinutes:
          type: integer
        roundingMinutes:
          type: integer
        workingDays:
          type: array
          items:
            type: integer
        isDefault:
          type: boolean
    AttendanceShift:
      type: object
      properties:
        id:
          type: string
        orgId:
          type: string
        name:
          type: string
        timezone:
          type: string
        workStartTime:
          type: string
        workEndTime:
          type: string
        lateGraceMinutes:
          type: integer
        earlyGraceMinutes:
          type: integer
        roundingMinutes:
          type: integer
        workingDays:
          type: array
          items:
            type: integer
    AttendanceShiftAssignment:
      type: object
      properties:
        id:
          type: string
        orgId:
          type: string
        userId:
          type: string
        shiftId:
          type: string
        startDate:
          type: string
          format: date
        endDate:
          type: string
          format: date
          nullable: true
        isActive:
          type: boolean
    AttendanceHoliday:
      type: object
      properties:
        id:
          type: string
        orgId:
          type: string
        date:
          type: string
          format: date
        name:
          type: string
          nullable: true
        isWorkingDay:
          type: boolean
    AttendanceSettings:
      type: object
      properties:
        autoAbsence:
          type: object
          properties:
            enabled:
              type: boolean
            runAt:
              type: string
            lookbackDays:
              type: integer
        ipAllowlist:
          type: array
          items:
            type: string
        geoFence:
          type: object
          nullable: true
          properties:
            lat:
              type: number
            lng:
              type: number
            radiusMeters:
              type: integer
        minPunchIntervalMinutes:
          type: integer
    Spreadsheet:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        owner_id:
          type: string
          nullable: true
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
        deleted_at:
          type: string
          format: date-time
          nullable: true
    Sheet:
      type: object
      properties:
        id:
          type: string
        spreadsheet_id:
          type: string
        name:
          type: string
        order_index:
          type: integer
        row_count:
          type: integer
        column_count:
          type: integer
        frozen_rows:
          type: integer
          nullable: true
        frozen_columns:
          type: integer
          nullable: true
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
    Cell:
      type: object
      properties:
        id:
          type: string
        sheet_id:
          type: string
        row_index:
          type: integer
        column_index:
          type: integer
        value:
          nullable: true
        data_type:
          type: string
          nullable: true
        formula:
          type: string
          nullable: true
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time
  responses:
    Unauthorized:
      description: Unauthorized - Missing or invalid JWT token
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          examples:
            missing_token:
              summary: Missing Authorization Header
              value:
                ok: false
                error:
                  code: UNAUTHORIZED
                  message: Authorization header is required
            invalid_token:
              summary: Invalid JWT Token
              value:
                ok: false
                error:
                  code: INVALID_TOKEN
                  message: Invalid or expired JWT token
            malformed_token:
              summary: Malformed Token
              value:
                ok: false
                error:
                  code: MALFORMED_TOKEN
                  message: Authorization header must start with 'Bearer '
    Forbidden:
      description: Forbidden - Insufficient permissions
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          examples:
            insufficient_permissions:
              summary: Insufficient Permissions
              value:
                ok: false
                error:
                  code: FORBIDDEN
                  message: You do not have permission to perform this action
            role_restricted:
              summary: Role Restriction
              value:
                ok: false
                error:
                  code: ROLE_RESTRICTED
                  message: This action requires admin privileges
            resource_access_denied:
              summary: Resource Access Denied
              value:
                ok: false
                error:
                  code: ACCESS_DENIED
                  message: Access denied to this resource
    ValidationError:
      description: Validation error - Invalid request data
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          examples:
            missing_required_field:
              summary: Missing Required Field
              value:
                ok: false
                error:
                  code: VALIDATION_ERROR
                  message: Required field 'name' is missing
            invalid_field_type:
              summary: Invalid Field Type
              value:
                ok: false
                error:
                  code: INVALID_TYPE
                  message: Field 'page' must be a positive integer
            invalid_field_value:
              summary: Invalid Field Value
              value:
                ok: false
                error:
                  code: INVALID_VALUE
                  message: Field 'pageSize' must be between 1 and 100
            invalid_request_format:
              summary: Invalid Request Format
              value:
                ok: false
                error:
                  code: INVALID_FORMAT
                  message: Request body must be valid JSON
    NotFound:
      description: Not found - Resource does not exist
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          examples:
            resource_not_found:
              summary: Resource Not Found
              value:
                ok: false
                error:
                  code: NOT_FOUND
                  message: The requested resource was not found
            user_not_found:
              summary: User Not Found
              value:
                ok: false
                error:
                  code: USER_NOT_FOUND
                  message: User with ID 'user123' does not exist
            role_not_found:
              summary: Role Not Found
              value:
                ok: false
                error:
                  code: ROLE_NOT_FOUND
                  message: Role with ID 'role456' does not exist
            spreadsheet_not_found:
              summary: Spreadsheet Not Found
              value:
                ok: false
                error:
                  code: SPREADSHEET_NOT_FOUND
                  message: Spreadsheet with ID 'sheet789' does not exist
            file_not_found:
              summary: File Not Found
              value:
                ok: false
                error:
                  code: FILE_NOT_FOUND
                  message: File with ID 'file123' does not exist
    ServiceUnavailable:
      description: Service unavailable - Temporary server issues
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
          examples:
            database_unavailable:
              summary: Database Unavailable
              value:
                ok: false
                error:
                  code: DATABASE_UNAVAILABLE
                  message: Database connection temporarily unavailable
            service_overloaded:
              summary: Service Overloaded
              value:
                ok: false
                error:
                  code: SERVICE_OVERLOADED
                  message: Service temporarily overloaded, please try again later
            maintenance_mode:
              summary: Maintenance Mode
              value:
                ok: false
                error:
                  code: MAINTENANCE
                  message: Service is temporarily under maintenance
    Pagination:
      type: object
      properties:
        items:
          type: array
          items: {}
        page:
          type: integer
          minimum: 1
        pageSize:
          type: integer
          minimum: 1
        total:
          type: integer
          minimum: 0
paths:
  /api/admin/plugins:
    get:
      summary: List plugins (admin)
      security:
        - bearerAuth: []
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  count:
                    type: integer
                  list:
                    type: array
                    items:
                      $ref: '#/components/schemas/PluginAdminEntry'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
  /api/admin/plugins/health:
    get:
      summary: Plugin health status (admin)
      security:
        - bearerAuth: []
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  count:
                    type: integer
                  health:
                    type: array
                    items:
                      type: object
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
  /api/admin/plugins/{id}:
    get:
      summary: Get plugin detail (admin)
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  plugin:
                    $ref: '#/components/schemas/PluginAdminEntry'
                  config:
                    $ref: '#/components/schemas/PluginConfigEntry'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          description: Not Found
    delete:
      summary: Unload plugin (admin)
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        '200':
          description: OK
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
  /api/admin/plugins/{id}/enable:
    post:
      summary: Enable plugin (admin)
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        '200':
          description: OK
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
  /api/admin/plugins/{id}/disable:
    post:
      summary: Disable plugin (admin)
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        '200':
          description: OK
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
  /api/admin/plugins/{id}/reload:
    post:
      summary: Reload plugin (admin)
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        '200':
          description: OK
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
  /api/admin/plugins/reload-all:
    post:
      summary: Reload all plugins (admin)
      security:
        - bearerAuth: []
      responses:
        '200':
          description: OK
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
  /api/admin/plugins/{id}/config:
    get:
      summary: Get plugin config (admin)
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  pluginId:
                    type: string
                  config:
                    $ref: '#/components/schemas/PluginConfigEntry'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
    put:
      summary: Update plugin config (admin)
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                config:
                  type: object
                schema:
                  type: object
                  nullable: true
                version:
                  type: string
              required:
                - config
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
  /api/approvals/{id}:
    get:
      summary: Get approval instance
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        '200':
          description: OK
        '404':
          description: Not found
  /api/approvals/{id}/approve:
    post:
      summary: Approve instance with optimistic locking
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                version:
                  type: integer
              required:
                - version
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      id:
                        type: string
                        example: demo-1
                      status:
                        type: string
                        example: APPROVED
                      version:
                        type: integer
                        example: 1
                      prevVersion:
                        type: integer
                        example: 0
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '409':
          description: Version conflict
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              examples:
                conflict:
                  value:
                    ok: false
                    error:
                      code: APPROVAL_VERSION_CONFLICT
                      message: Approval instance version mismatch
                      currentVersion: 1
  /api/approvals/{id}/reject:
    post:
      summary: Reject instance with optimistic locking
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                version:
                  type: integer
              required:
                - version
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      id:
                        type: string
                        example: demo-1
                      status:
                        type: string
                        example: REJECTED
                      version:
                        type: integer
                        example: 2
                      prevVersion:
                        type: integer
                        example: 1
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '409':
          $ref: '#/components/responses/ValidationError'
  /api/approvals/{id}/return:
    post:
      summary: Return instance with optimistic locking
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                version:
                  type: integer
              required:
                - version
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      id:
                        type: string
                        example: demo-1
                      status:
                        type: string
                        example: RETURNED
                      version:
                        type: integer
                        example: 3
                      prevVersion:
                        type: integer
                        example: 2
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '409':
          $ref: '#/components/responses/ValidationError'
  /api/approvals/{id}/revoke:
    post:
      summary: Revoke instance with optimistic locking
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                version:
                  type: integer
              required:
                - version
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      id:
                        type: string
                        example: demo-1
                      status:
                        type: string
                        example: REVOKED
                      version:
                        type: integer
                        example: 4
                      prevVersion:
                        type: integer
                        example: 3
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '409':
          $ref: '#/components/responses/ValidationError'
  /api/approvals/{id}/history:
    get:
      summary: Get approval history (from approval_records)
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
        - in: query
          name: page
          schema:
            type: integer
            default: 1
        - in: query
          name: pageSize
          schema:
            type: integer
            default: 50
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/Pagination'
              examples:
                sample:
                  value:
                    items:
                      - occurred_at: '2025-09-19T09:12:00Z'
                        actor_id: u1
                        action: approve
                        comment: LGTM
                        from_status: PENDING
                        to_status: APPROVED
                        version: 1
                    page: 1
                    pageSize: 50
                    total: 4
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '503':
          $ref: '#/components/responses/ServiceUnavailable'
  /api/attendance/punch:
    x-plugin: plugin-attendance
    post:
      summary: Punch attendance (check in/out)
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                eventType:
                  type: string
                  enum:
                    - check_in
                    - check_out
                occurredAt:
                  type: string
                  format: date-time
                timezone:
                  type: string
                source:
                  type: string
                location:
                  type: object
                meta:
                  type: object
                orgId:
                  type: string
              required:
                - eventType
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  data:
                    type: object
                    properties:
                      event:
                        $ref: '#/components/schemas/AttendanceEvent'
                      record:
                        $ref: '#/components/schemas/AttendanceRecord'
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
  /api/attendance/records:
    x-plugin: plugin-attendance
    get:
      summary: List attendance records
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: userId
          schema:
            type: string
        - in: query
          name: orgId
          schema:
            type: string
        - in: query
          name: from
          schema:
            type: string
            format: date
        - in: query
          name: to
          schema:
            type: string
            format: date
        - in: query
          name: page
          schema:
            type: integer
            default: 1
        - in: query
          name: pageSize
          schema:
            type: integer
            default: 50
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  data:
                    type: object
                    properties:
                      items:
                        type: array
                        items:
                          $ref: '#/components/schemas/AttendanceRecord'
                      total:
                        type: integer
                      page:
                        type: integer
                      pageSize:
                        type: integer
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
  /api/attendance/summary:
    x-plugin: plugin-attendance
    get:
      summary: Attendance summary
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: userId
          schema:
            type: string
        - in: query
          name: orgId
          schema:
            type: string
        - in: query
          name: from
          schema:
            type: string
            format: date
        - in: query
          name: to
          schema:
            type: string
            format: date
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  data:
                    $ref: '#/components/schemas/AttendanceSummary'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
  /api/attendance/requests:
    x-plugin: plugin-attendance
    post:
      summary: Create attendance adjustment request
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                workDate:
                  type: string
                  format: date
                requestType:
                  type: string
                  enum:
                    - missed_check_in
                    - missed_check_out
                    - time_correction
                    - leave
                    - overtime
                requestedInAt:
                  type: string
                  format: date-time
                requestedOutAt:
                  type: string
                  format: date-time
                reason:
                  type: string
                leaveTypeId:
                  type: string
                leaveTypeCode:
                  type: string
                overtimeRuleId:
                  type: string
                overtimeRuleName:
                  type: string
                minutes:
                  type: integer
                attachmentUrl:
                  type: string
                approvalFlowId:
                  type: string
                orgId:
                  type: string
              required:
                - workDate
                - requestType
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  data:
                    type: object
                    properties:
                      request:
                        $ref: '#/components/schemas/AttendanceRequest'
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
    get:
      summary: List attendance requests
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: userId
          schema:
            type: string
        - in: query
          name: orgId
          schema:
            type: string
        - in: query
          name: status
          schema:
            type: string
        - in: query
          name: from
          schema:
            type: string
            format: date
        - in: query
          name: to
          schema:
            type: string
            format: date
        - in: query
          name: page
          schema:
            type: integer
            default: 1
        - in: query
          name: pageSize
          schema:
            type: integer
            default: 50
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  data:
                    type: object
                    properties:
                      items:
                        type: array
                        items:
                          $ref: '#/components/schemas/AttendanceRequest'
                      total:
                        type: integer
                      page:
                        type: integer
                      pageSize:
                        type: integer
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
  /api/attendance/requests/{id}/approve:
    x-plugin: plugin-attendance
    post:
      summary: Approve attendance request
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                comment:
                  type: string
                metadata:
                  type: object
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  data:
                    type: object
                    properties:
                      requestId:
                        type: string
                      status:
                        type: string
                      orgId:
                        type: string
                      userId:
                        type: string
                      record:
                        $ref: '#/components/schemas/AttendanceRecord'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
  /api/attendance/requests/{id}/reject:
    x-plugin: plugin-attendance
    post:
      summary: Reject attendance request
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                comment:
                  type: string
                metadata:
                  type: object
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  data:
                    type: object
                    properties:
                      requestId:
                        type: string
                      status:
                        type: string
                      orgId:
                        type: string
                      userId:
                        type: string
                      record:
                        nullable: true
                        allOf:
                          - $ref: '#/components/schemas/AttendanceRecord'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
  /api/attendance/requests/{id}/cancel:
    x-plugin: plugin-attendance
    post:
      summary: Cancel attendance request
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                comment:
                  type: string
                metadata:
                  type: object
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  data:
                    type: object
                    properties:
                      requestId:
                        type: string
                      status:
                        type: string
                      orgId:
                        type: string
                      userId:
                        type: string
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
  /api/attendance/rules/default:
    x-plugin: plugin-attendance
    get:
      summary: Get default attendance rule
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: orgId
          schema:
            type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  data:
                    $ref: '#/components/schemas/AttendanceRule'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
    put:
      summary: Update default attendance rule
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                timezone:
                  type: string
                workStartTime:
                  type: string
                workEndTime:
                  type: string
                lateGraceMinutes:
                  type: integer
                earlyGraceMinutes:
                  type: integer
                roundingMinutes:
                  type: integer
                workingDays:
                  type: array
                  items:
                    type: integer
                orgId:
                  type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  data:
                    $ref: '#/components/schemas/AttendanceRule'
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
  /api/attendance/shifts:
    x-plugin: plugin-attendance
    get:
      summary: List attendance shifts
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: orgId
          schema:
            type: string
        - in: query
          name: page
          schema:
            type: integer
            default: 1
        - in: query
          name: pageSize
          schema:
            type: integer
            default: 50
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  data:
                    type: object
                    properties:
                      items:
                        type: array
                        items:
                          $ref: '#/components/schemas/AttendanceShift'
                      total:
                        type: integer
                      page:
                        type: integer
                      pageSize:
                        type: integer
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
    post:
      summary: Create attendance shift
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                timezone:
                  type: string
                workStartTime:
                  type: string
                workEndTime:
                  type: string
                lateGraceMinutes:
                  type: integer
                earlyGraceMinutes:
                  type: integer
                roundingMinutes:
                  type: integer
                workingDays:
                  type: array
                  items:
                    type: integer
                orgId:
                  type: string
              required:
                - name
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  data:
                    $ref: '#/components/schemas/AttendanceShift'
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
  /api/attendance/shifts/{id}:
    x-plugin: plugin-attendance
    put:
      summary: Update attendance shift
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                timezone:
                  type: string
                workStartTime:
                  type: string
                workEndTime:
                  type: string
                lateGraceMinutes:
                  type: integer
                earlyGraceMinutes:
                  type: integer
                roundingMinutes:
                  type: integer
                workingDays:
                  type: array
                  items:
                    type: integer
                orgId:
                  type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  data:
                    $ref: '#/components/schemas/AttendanceShift'
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
    delete:
      summary: Delete attendance shift
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  data:
                    type: object
                    properties:
                      id:
                        type: string
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
  /api/attendance/assignments:
    x-plugin: plugin-attendance
    get:
      summary: List attendance shift assignments
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: orgId
          schema:
            type: string
        - in: query
          name: userId
          schema:
            type: string
        - in: query
          name: page
          schema:
            type: integer
            default: 1
        - in: query
          name: pageSize
          schema:
            type: integer
            default: 50
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  data:
                    type: object
                    properties:
                      items:
                        type: array
                        items:
                          type: object
                          properties:
                            assignment:
                              $ref: '#/components/schemas/AttendanceShiftAssignment'
                            shift:
                              $ref: '#/components/schemas/AttendanceShift'
                      total:
                        type: integer
                      page:
                        type: integer
                      pageSize:
                        type: integer
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
    post:
      summary: Create attendance shift assignment
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                userId:
                  type: string
                shiftId:
                  type: string
                startDate:
                  type: string
                  format: date
                endDate:
                  type: string
                  format: date
                  nullable: true
                isActive:
                  type: boolean
                orgId:
                  type: string
              required:
                - userId
                - shiftId
                - startDate
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  data:
                    type: object
                    properties:
                      assignment:
                        $ref: '#/components/schemas/AttendanceShiftAssignment'
                      shift:
                        $ref: '#/components/schemas/AttendanceShift'
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
  /api/attendance/assignments/{id}:
    x-plugin: plugin-attendance
    put:
      summary: Update attendance shift assignment
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                userId:
                  type: string
                shiftId:
                  type: string
                startDate:
                  type: string
                  format: date
                endDate:
                  type: string
                  format: date
                  nullable: true
                isActive:
                  type: boolean
                orgId:
                  type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  data:
                    type: object
                    properties:
                      assignment:
                        $ref: '#/components/schemas/AttendanceShiftAssignment'
                      shift:
                        $ref: '#/components/schemas/AttendanceShift'
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
    delete:
      summary: Delete attendance shift assignment
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  data:
                    type: object
                    properties:
                      id:
                        type: string
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
  /api/attendance/holidays:
    x-plugin: plugin-attendance
    get:
      summary: List attendance holidays
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: orgId
          schema:
            type: string
        - in: query
          name: from
          schema:
            type: string
            format: date
        - in: query
          name: to
          schema:
            type: string
            format: date
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  data:
                    type: object
                    properties:
                      items:
                        type: array
                        items:
                          $ref: '#/components/schemas/AttendanceHoliday'
                      total:
                        type: integer
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
    post:
      summary: Create attendance holiday
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                date:
                  type: string
                  format: date
                name:
                  type: string
                  nullable: true
                isWorkingDay:
                  type: boolean
                orgId:
                  type: string
              required:
                - date
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  data:
                    $ref: '#/components/schemas/AttendanceHoliday'
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
  /api/attendance/holidays/{id}:
    x-plugin: plugin-attendance
    put:
      summary: Update attendance holiday
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                date:
                  type: string
                  format: date
                name:
                  type: string
                  nullable: true
                isWorkingDay:
                  type: boolean
                orgId:
                  type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  data:
                    $ref: '#/components/schemas/AttendanceHoliday'
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
    delete:
      summary: Delete attendance holiday
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  data:
                    type: object
                    properties:
                      id:
                        type: string
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
  /api/attendance/settings:
    x-plugin: plugin-attendance
    get:
      summary: Get attendance settings
      security:
        - bearerAuth: []
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  data:
                    $ref: '#/components/schemas/AttendanceSettings'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
    put:
      summary: Update attendance settings
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: '#/components/schemas/AttendanceSettings'
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  data:
                    $ref: '#/components/schemas/AttendanceSettings'
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
  /api/attendance/export:
    x-plugin: plugin-attendance
    get:
      summary: Export attendance records as CSV
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: userId
          schema:
            type: string
        - in: query
          name: orgId
          schema:
            type: string
        - in: query
          name: from
          schema:
            type: string
            format: date
        - in: query
          name: to
          schema:
            type: string
            format: date
        - in: query
          name: limit
          schema:
            type: integer
            default: 1000
            maximum: 5000
      responses:
        '200':
          description: CSV export
          content:
            text/csv:
              schema:
                type: string
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
  /api/attendance/reports/requests:
    x-plugin: plugin-attendance
    get:
      summary: Attendance request report
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: userId
          schema:
            type: string
        - in: query
          name: orgId
          schema:
            type: string
        - in: query
          name: from
          schema:
            type: string
            format: date
        - in: query
          name: to
          schema:
            type: string
            format: date
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  data:
                    type: object
                    properties:
                      items:
                        type: array
                        items:
                          $ref: '#/components/schemas/AttendanceRequestReportItem'
                      from:
                        type: string
                        format: date
                      to:
                        type: string
                        format: date
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
  /api/attendance/leave-types:
    x-plugin: plugin-attendance
    get:
      summary: List leave types
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: orgId
          schema:
            type: string
        - in: query
          name: isActive
          schema:
            type: boolean
        - in: query
          name: page
          schema:
            type: integer
            default: 1
        - in: query
          name: pageSize
          schema:
            type: integer
            default: 50
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  data:
                    type: object
                    properties:
                      items:
                        type: array
                        items:
                          $ref: '#/components/schemas/AttendanceLeaveType'
                      total:
                        type: integer
                      page:
                        type: integer
                      pageSize:
                        type: integer
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
    post:
      summary: Create leave type
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                code:
                  type: string
                name:
                  type: string
                requiresApproval:
                  type: boolean
                requiresAttachment:
                  type: boolean
                defaultMinutesPerDay:
                  type: integer
                isActive:
                  type: boolean
                orgId:
                  type: string
              required:
                - code
                - name
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  data:
                    $ref: '#/components/schemas/AttendanceLeaveType'
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
  /api/attendance/leave-types/{id}:
    x-plugin: plugin-attendance
    put:
      summary: Update leave type
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                code:
                  type: string
                name:
                  type: string
                requiresApproval:
                  type: boolean
                requiresAttachment:
                  type: boolean
                defaultMinutesPerDay:
                  type: integer
                isActive:
                  type: boolean
                orgId:
                  type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  data:
                    $ref: '#/components/schemas/AttendanceLeaveType'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
    delete:
      summary: Delete leave type
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  data:
                    type: object
                    properties:
                      id:
                        type: string
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
  /api/attendance/overtime-rules:
    x-plugin: plugin-attendance
    get:
      summary: List overtime rules
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: orgId
          schema:
            type: string
        - in: query
          name: isActive
          schema:
            type: boolean
        - in: query
          name: page
          schema:
            type: integer
            default: 1
        - in: query
          name: pageSize
          schema:
            type: integer
            default: 50
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  data:
                    type: object
                    properties:
                      items:
                        type: array
                        items:
                          $ref: '#/components/schemas/AttendanceOvertimeRule'
                      total:
                        type: integer
                      page:
                        type: integer
                      pageSize:
                        type: integer
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
    post:
      summary: Create overtime rule
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                minMinutes:
                  type: integer
                roundingMinutes:
                  type: integer
                maxMinutesPerDay:
                  type: integer
                requiresApproval:
                  type: boolean
                isActive:
                  type: boolean
                orgId:
                  type: string
              required:
                - name
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  data:
                    $ref: '#/components/schemas/AttendanceOvertimeRule'
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
  /api/attendance/overtime-rules/{id}:
    x-plugin: plugin-attendance
    put:
      summary: Update overtime rule
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                minMinutes:
                  type: integer
                roundingMinutes:
                  type: integer
                maxMinutesPerDay:
                  type: integer
                requiresApproval:
                  type: boolean
                isActive:
                  type: boolean
                orgId:
                  type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  data:
                    $ref: '#/components/schemas/AttendanceOvertimeRule'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
    delete:
      summary: Delete overtime rule
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  data:
                    type: object
                    properties:
                      id:
                        type: string
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
  /api/attendance/approval-flows:
    x-plugin: plugin-attendance
    get:
      summary: List approval flows
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: orgId
          schema:
            type: string
        - in: query
          name: requestType
          schema:
            type: string
        - in: query
          name: isActive
          schema:
            type: boolean
        - in: query
          name: page
          schema:
            type: integer
            default: 1
        - in: query
          name: pageSize
          schema:
            type: integer
            default: 50
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  data:
                    type: object
                    properties:
                      items:
                        type: array
                        items:
                          $ref: '#/components/schemas/AttendanceApprovalFlow'
                      total:
                        type: integer
                      page:
                        type: integer
                      pageSize:
                        type: integer
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
    post:
      summary: Create approval flow
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                requestType:
                  type: string
                steps:
                  type: array
                  items:
                    $ref: '#/components/schemas/AttendanceApprovalStep'
                isActive:
                  type: boolean
                orgId:
                  type: string
              required:
                - name
                - requestType
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  data:
                    $ref: '#/components/schemas/AttendanceApprovalFlow'
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
  /api/attendance/approval-flows/{id}:
    x-plugin: plugin-attendance
    put:
      summary: Update approval flow
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                requestType:
                  type: string
                steps:
                  type: array
                  items:
                    $ref: '#/components/schemas/AttendanceApprovalStep'
                isActive:
                  type: boolean
                orgId:
                  type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  data:
                    $ref: '#/components/schemas/AttendanceApprovalFlow'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
    delete:
      summary: Delete approval flow
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  data:
                    type: object
                    properties:
                      id:
                        type: string
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
  /api/attendance/rotation-rules:
    x-plugin: plugin-attendance
    get:
      summary: List rotation rules
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: orgId
          schema:
            type: string
        - in: query
          name: isActive
          schema:
            type: boolean
        - in: query
          name: page
          schema:
            type: integer
            default: 1
        - in: query
          name: pageSize
          schema:
            type: integer
            default: 50
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  data:
                    type: object
                    properties:
                      items:
                        type: array
                        items:
                          $ref: '#/components/schemas/AttendanceRotationRule'
                      total:
                        type: integer
                      page:
                        type: integer
                      pageSize:
                        type: integer
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
    post:
      summary: Create rotation rule
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                timezone:
                  type: string
                shiftSequence:
                  type: array
                  items:
                    type: string
                isActive:
                  type: boolean
                orgId:
                  type: string
              required:
                - name
                - shiftSequence
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  data:
                    $ref: '#/components/schemas/AttendanceRotationRule'
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
  /api/attendance/rotation-rules/{id}:
    x-plugin: plugin-attendance
    put:
      summary: Update rotation rule
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                timezone:
                  type: string
                shiftSequence:
                  type: array
                  items:
                    type: string
                isActive:
                  type: boolean
                orgId:
                  type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  data:
                    $ref: '#/components/schemas/AttendanceRotationRule'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
    delete:
      summary: Delete rotation rule
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  data:
                    type: object
                    properties:
                      id:
                        type: string
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
  /api/attendance/rotation-assignments:
    x-plugin: plugin-attendance
    get:
      summary: List rotation assignments
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: orgId
          schema:
            type: string
        - in: query
          name: page
          schema:
            type: integer
            default: 1
        - in: query
          name: pageSize
          schema:
            type: integer
            default: 50
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  data:
                    type: object
                    properties:
                      items:
                        type: array
                        items:
                          $ref: >-
                            #/components/schemas/AttendanceRotationAssignmentItem
                      total:
                        type: integer
                      page:
                        type: integer
                      pageSize:
                        type: integer
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
    post:
      summary: Create rotation assignment
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                userId:
                  type: string
                rotationRuleId:
                  type: string
                startDate:
                  type: string
                  format: date
                endDate:
                  type: string
                  format: date
                  nullable: true
                isActive:
                  type: boolean
                orgId:
                  type: string
              required:
                - userId
                - rotationRuleId
                - startDate
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  data:
                    type: object
                    properties:
                      assignment:
                        $ref: '#/components/schemas/AttendanceRotationAssignment'
                      rotation:
                        $ref: '#/components/schemas/AttendanceRotationRule'
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
  /api/attendance/rotation-assignments/{id}:
    x-plugin: plugin-attendance
    put:
      summary: Update rotation assignment
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                userId:
                  type: string
                rotationRuleId:
                  type: string
                startDate:
                  type: string
                  format: date
                endDate:
                  type: string
                  format: date
                  nullable: true
                isActive:
                  type: boolean
                orgId:
                  type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  data:
                    type: object
                    properties:
                      assignment:
                        $ref: '#/components/schemas/AttendanceRotationAssignment'
                      rotation:
                        $ref: '#/components/schemas/AttendanceRotationRule'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
    delete:
      summary: Delete rotation assignment
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  data:
                    type: object
                    properties:
                      id:
                        type: string
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
  /api/audit-logs:
    get:
      summary: Admin-only audit log query
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: actorId
          schema:
            type: string
        - in: query
          name: resourceType
          schema:
            type: string
        - in: query
          name: resourceId
          schema:
            type: string
        - in: query
          name: action
          schema:
            type: string
        - in: query
          name: from
          schema:
            type: string
            format: date-time
        - in: query
          name: to
          schema:
            type: string
            format: date-time
        - in: query
          name: page
          schema:
            type: integer
            default: 1
        - in: query
          name: pageSize
          schema:
            type: integer
            default: 50
      responses:
        '200':
          description: OK
        '403':
          description: Forbidden
  /api/auth/dev-token:
    get:
      summary: Issue dev token (non-production)
      parameters:
        - in: query
          name: userId
          schema:
            type: string
        - in: query
          name: roles
          schema:
            type: string
        - in: query
          name: perms
          schema:
            type: string
        - in: query
          name: expiresIn
          schema:
            type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  token:
                    type: string
                  payload:
                    type: object
        '404':
          description: Not found
  /api/auth/login:
    post:
      summary: User login
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                email:
                  type: string
                password:
                  type: string
              required:
                - email
                - password
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      user:
                        $ref: '#/components/schemas/User'
                      token:
                        type: string
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '429':
          description: Too many requests
  /api/auth/register:
    post:
      summary: User registration
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                email:
                  type: string
                password:
                  type: string
              required:
                - name
                - email
                - password
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      user:
                        $ref: '#/components/schemas/User'
                      token:
                        type: string
        '400':
          $ref: '#/components/responses/ValidationError'
        '409':
          description: Conflict
        '429':
          description: Too many requests
  /api/auth/refresh-token:
    post:
      summary: Refresh JWT token
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                token:
                  type: string
              required:
                - token
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      token:
                        type: string
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/Unauthorized'
  /api/auth/verify:
    get:
      summary: Verify JWT token
      security:
        - bearerAuth: []
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      user:
                        $ref: '#/components/schemas/User'
        '401':
          $ref: '#/components/responses/Unauthorized'
  /api/auth/me:
    get:
      summary: Get current user
      security:
        - bearerAuth: []
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      user:
                        $ref: '#/components/schemas/User'
        '401':
          $ref: '#/components/responses/Unauthorized'
  /api/comments:
    get:
      summary: List comments
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: spreadsheetId
          required: true
          schema:
            type: string
        - in: query
          name: rowId
          schema:
            type: string
        - in: query
          name: resolved
          schema:
            type: boolean
        - in: query
          name: limit
          schema:
            type: integer
            default: 50
        - in: query
          name: offset
          schema:
            type: integer
            default: 0
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/CommentsListResponse'
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
    post:
      summary: Create comment
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                spreadsheetId:
                  type: string
                rowId:
                  type: string
                fieldId:
                  type: string
                content:
                  type: string
                parentId:
                  type: string
              required:
                - spreadsheetId
                - rowId
                - content
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  data:
                    type: object
                    properties:
                      comment:
                        $ref: '#/components/schemas/Comment'
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
  /api/comments/{commentId}/resolve:
    post:
      summary: Resolve a comment
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: commentId
          required: true
          schema:
            type: string
      responses:
        '204':
          description: No Content
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
  /api/data-sources:
    get:
      summary: List data sources
      security:
        - bearerAuth: []
      responses:
        '200':
          description: OK
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
    post:
      summary: Create data source
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
      responses:
        '201':
          description: Created
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
  /api/data-sources/{id}:
    get:
      summary: Get data source
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        '200':
          description: OK
        '404':
          $ref: '#/components/responses/NotFound'
    put:
      summary: Update data source
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/ValidationError'
        '404':
          $ref: '#/components/responses/NotFound'
    delete:
      summary: Delete data source
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        '200':
          description: OK
        '404':
          $ref: '#/components/responses/NotFound'
  /api/data-sources/{id}/connect:
    post:
      summary: Connect data source
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        '200':
          description: OK
  /api/data-sources/{id}/disconnect:
    post:
      summary: Disconnect data source
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        '200':
          description: OK
  /api/data-sources/{id}/test:
    get:
      summary: Test data source connection
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        '200':
          description: OK
  /api/data-sources/health:
    get:
      summary: Data sources health check
      security:
        - bearerAuth: []
      responses:
        '200':
          description: OK
  /api/data-sources/{id}/query:
    post:
      summary: Run SQL query
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                sql:
                  type: string
                params:
                  type: array
                  items: {}
              required:
                - sql
      responses:
        '200':
          description: OK
  /api/data-sources/{id}/select:
    post:
      summary: Select from table
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                table:
                  type: string
                select:
                  type: array
                  items:
                    type: string
                where:
                  type: object
                orderBy:
                  type: array
                  items:
                    type: object
                    properties:
                      column:
                        type: string
                      direction:
                        type: string
                limit:
                  type: integer
                offset:
                  type: integer
              required:
                - table
      responses:
        '200':
          description: OK
  /api/data-sources/{id}/schema:
    get:
      summary: Get data source schema
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        '200':
          description: OK
  /api/data-sources/{id}/tables/{table}:
    get:
      summary: Get table schema
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
        - in: path
          name: table
          required: true
          schema:
            type: string
      responses:
        '200':
          description: OK
  /api/permissions:
    get:
      summary: List all permissions
      security:
        - bearerAuth: []
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  data:
                    type: array
                    items:
                      $ref: '#/components/schemas/Permission'
                  total:
                    type: integer
        '401':
          $ref: '#/components/responses/Unauthorized'
  /api/permissions/me:
    get:
      summary: Get current user permissions
      security:
        - bearerAuth: []
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  userId:
                    type: string
                  permissions:
                    type: array
                    items:
                      type: string
                  isAdmin:
                    type: boolean
        '401':
          $ref: '#/components/responses/Unauthorized'
  /api/permissions/check:
    post:
      summary: Check permission for a user
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                permission:
                  type: string
                userId:
                  type: string
              required:
                - permission
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  userId:
                    type: string
                  permission:
                    type: string
                  allowed:
                    type: boolean
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
  /api/permissions/grant:
    post:
      summary: Grant permission (admin only)
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                userId:
                  type: string
                permission:
                  type: string
              required:
                - userId
                - permission
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
  /api/permissions/revoke:
    post:
      summary: Revoke permission (admin only)
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                userId:
                  type: string
                permission:
                  type: string
              required:
                - userId
                - permission
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
  /api/permissions/health:
    get:
      summary: Permissions health check
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                  degraded:
                    type: boolean
                  timestamp:
                    type: string
  /api/roles:
    get:
      summary: List roles
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: page
          schema:
            type: integer
            default: 1
        - in: query
          name: pageSize
          schema:
            type: integer
            default: 50
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                  data:
                    type: object
                    properties:
                      items:
                        type: array
                        items:
                          $ref: '#/components/schemas/Role'
                      page:
                        type: integer
                      pageSize:
                        type: integer
                      total:
                        type: integer
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
    post:
      summary: Create role
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                id:
                  type: string
                name:
                  type: string
                permissions:
                  type: array
                  items:
                    type: string
      responses:
        '200':
          description: OK
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
  /api/roles/{id}:
    put:
      summary: Update role
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
                permissions:
                  type: array
                  items:
                    type: string
      responses:
        '200':
          description: OK
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
    delete:
      summary: Delete role
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        '200':
          description: OK
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
  /api/spreadsheets/{id}/permissions:
    get:
      summary: List spreadsheet permissions
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      items:
                        type: array
                        items:
                          type: object
                          properties:
                            userId:
                              type: string
                            permissions:
                              type: array
                              items:
                                type: string
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
  /api/spreadsheets/{id}/permissions/grant:
    post:
      summary: Grant spreadsheet permission
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                userId:
                  type: string
                permission:
                  type: string
              required:
                - userId
                - permission
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
  /api/spreadsheets/{id}/permissions/revoke:
    post:
      summary: Revoke spreadsheet permission
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                userId:
                  type: string
                permission:
                  type: string
              required:
                - userId
                - permission
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
  /api/spreadsheets:
    get:
      summary: List spreadsheets
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: page
          schema:
            type: integer
            default: 1
        - in: query
          name: pageSize
          schema:
            type: integer
            default: 50
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      items:
                        type: array
                        items:
                          $ref: '#/components/schemas/Spreadsheet'
                      page:
                        type: integer
                      pageSize:
                        type: integer
                      total:
                        type: integer
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
    post:
      summary: Create spreadsheet
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                id:
                  type: string
                name:
                  type: string
                owner_id:
                  type: string
                ownerId:
                  type: string
                workspace_id:
                  type: string
                initial_sheets:
                  type: array
                  items:
                    type: object
                    properties:
                      id:
                        type: string
                      name:
                        type: string
                    required:
                      - name
              required:
                - name
      responses:
        '201':
          description: Created
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      spreadsheet:
                        $ref: '#/components/schemas/Spreadsheet'
                      sheets:
                        type: array
                        items:
                          $ref: '#/components/schemas/Sheet'
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
  /api/spreadsheets/{id}:
    get:
      summary: Get spreadsheet
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                    example: true
                  data:
                    allOf:
                      - $ref: '#/components/schemas/Spreadsheet'
                      - type: object
                        properties:
                          sheets:
                            type: array
                            items:
                              $ref: '#/components/schemas/Sheet'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
    put:
      summary: Update spreadsheet
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name:
                  type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/Spreadsheet'
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
    delete:
      summary: Delete spreadsheet
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      id:
                        type: string
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
  /api/spreadsheets/{id}/sheets/{sheetId}:
    put:
      summary: Update sheet metadata
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
        - in: path
          name: sheetId
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                row_count:
                  type: integer
                  minimum: 1
                rowCount:
                  type: integer
                  minimum: 1
                column_count:
                  type: integer
                  minimum: 1
                columnCount:
                  type: integer
                  minimum: 1
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                    example: true
                  data:
                    $ref: '#/components/schemas/Sheet'
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
  /api/spreadsheets/{id}/sheets/{sheetId}/cells:
    get:
      summary: Get spreadsheet cells
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
        - in: path
          name: sheetId
          required: true
          schema:
            type: string
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      sheet:
                        $ref: '#/components/schemas/Sheet'
                      cells:
                        type: array
                        items:
                          $ref: '#/components/schemas/Cell'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
    put:
      summary: Update spreadsheet cells
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
        - in: path
          name: sheetId
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                cells:
                  type: array
                  items:
                    type: object
                    properties:
                      row:
                        type: integer
                        minimum: 0
                      col:
                        type: integer
                        minimum: 0
                      value:
                        nullable: true
                      formula:
                        type: string
                      dataType:
                        type: string
                      data_type:
                        type: string
                    required:
                      - row
                      - col
              required:
                - cells
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok:
                    type: boolean
                    example: true
                  data:
                    type: object
                    properties:
                      cells:
                        type: array
                        items:
                          $ref: '#/components/schemas/Cell'
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
  /api/views/{viewId}/config:
    get:
      summary: Get view configuration
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: viewId
          required: true
          schema:
            type: string
      responses:
        '200':
          description: OK
        '404':
          $ref: '#/components/responses/NotFound'
    put:
      summary: Update view configuration
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: viewId
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
      responses:
        '200':
          description: OK
        '404':
          $ref: '#/components/responses/NotFound'
    delete:
      summary: Delete view configuration
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: viewId
          required: true
          schema:
            type: string
      responses:
        '200':
          description: OK
        '404':
          $ref: '#/components/responses/NotFound'
  /api/views/{viewId}/data:
    get:
      summary: Get view data
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: viewId
          required: true
          schema:
            type: string
        - in: query
          name: page
          schema:
            type: integer
            default: 1
        - in: query
          name: pageSize
          schema:
            type: integer
            default: 50
        - in: query
          name: sort
          schema:
            type: string
        - in: query
          name: order
          schema:
            type: string
        - in: query
          name: search
          schema:
            type: string
        - in: query
          name: searchFields
          schema:
            type: string
        - in: query
          name: groupBy
          schema:
            type: string
      responses:
        '200':
          description: OK
        '404':
          $ref: '#/components/responses/NotFound'
  /api/views/{viewId}/state:
    post:
      summary: Update view state
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: viewId
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
      responses:
        '200':
          description: OK
        '404':
          $ref: '#/components/responses/NotFound'
    get:
      summary: Get view state
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: viewId
          required: true
          schema:
            type: string
      responses:
        '200':
          description: OK
        '404':
          $ref: '#/components/responses/NotFound'
  /api/workflow-designer/node-types:
    get:
      summary: List workflow designer node types
      security:
        - bearerAuth: []
      responses:
        '200':
          description: OK
  /api/workflow-designer/templates:
    get:
      summary: List workflow templates
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: category
          schema:
            type: string
        - in: query
          name: featured
          schema:
            type: boolean
      responses:
        '200':
          description: OK
  /api/workflow-designer/workflows:
    post:
      summary: Create workflow
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
      responses:
        '201':
          description: Created
        '400':
          $ref: '#/components/responses/ValidationError'
    get:
      summary: List workflows
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: category
          schema:
            type: string
        - in: query
          name: status
          schema:
            type: string
        - in: query
          name: search
          schema:
            type: string
      responses:
        '200':
          description: OK
  /api/workflow-designer/workflows/{id}:
    get:
      summary: Get workflow details
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        '200':
          description: OK
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
    put:
      summary: Update workflow
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
      responses:
        '200':
          description: OK
        '400':
          $ref: '#/components/responses/ValidationError'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
  /api/workflow-designer/workflows/{id}/validate:
    post:
      summary: Validate workflow
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        '200':
          description: OK
        '404':
          $ref: '#/components/responses/NotFound'
  /api/workflow-designer/workflows/{id}/deploy:
    post:
      summary: Deploy workflow
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      responses:
        '200':
          description: OK
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
  /api/workflow-designer/workflows/{id}/test:
    post:
      summary: Test workflow
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                variables:
                  type: object
      responses:
        '200':
          description: OK
        '404':
          $ref: '#/components/responses/NotFound'
  /api/workflow-designer/workflows/{id}/executions:
    get:
      summary: List workflow executions
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
        - in: query
          name: limit
          schema:
            type: integer
            default: 50
      responses:
        '200':
          description: OK
  /api/workflow-designer/workflows/{id}/share:
    post:
      summary: Share workflow
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: id
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                userId:
                  type: string
                role:
                  type: string
                permissions:
                  type: object
              required:
                - userId
                - role
      responses:
        '200':
          description: OK
        '403':
          $ref: '#/components/responses/Forbidden'
  /api/workflow/deploy:
    post:
      summary: Deploy workflow definition
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                bpmnFile:
                  type: string
                  format: binary
                key:
                  type: string
                name:
                  type: string
                category:
                  type: string
                description:
                  type: string
          application/json:
            schema:
              type: object
              properties:
                bpmnXml:
                  type: string
                key:
                  type: string
                name:
                  type: string
                category:
                  type: string
                description:
                  type: string
              required:
                - name
                - bpmnXml
      responses:
        '201':
          description: Created
        '400':
          $ref: '#/components/responses/ValidationError'
        '401':
          $ref: '#/components/responses/Unauthorized'
  /api/workflow/definitions:
    get:
      summary: List workflow definitions
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: category
          schema:
            type: string
        - in: query
          name: latest
          schema:
            type: boolean
      responses:
        '200':
          description: OK
        '401':
          $ref: '#/components/responses/Unauthorized'
  /api/workflow/start/{key}:
    post:
      summary: Start workflow instance
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: key
          required: true
          schema:
            type: string
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                businessKey:
                  type: string
                variables:
                  type: object
      responses:
        '201':
          description: Created
        '401':
          $ref: '#/components/responses/Unauthorized'
  /api/workflow/instances:
    get:
      summary: List workflow instances
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: state
          schema:
            type: string
        - in: query
          name: processKey
          schema:
            type: string
        - in: query
          name: businessKey
          schema:
            type: string
      responses:
        '200':
          description: OK
        '401':
          $ref: '#/components/responses/Unauthorized'
  /api/workflow/instances/{instanceId}:
    get:
      summary: Get workflow instance detail
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: instanceId
          required: true
          schema:
            type: string
      responses:
        '200':
          description: OK
        '404':
          $ref: '#/components/responses/NotFound'
  /api/workflow/tasks:
    get:
      summary: List workflow tasks
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: assignee
          schema:
            type: string
        - in: query
          name: candidateUser
          schema:
            type: string
        - in: query
          name: candidateGroup
          schema:
            type: string
        - in: query
          name: processInstanceId
          schema:
            type: string
        - in: query
          name: state
          schema:
            type: string
      responses:
        '200':
          description: OK
  /api/workflow/tasks/{taskId}/claim:
    post:
      summary: Claim workflow task
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: taskId
          required: true
          schema:
            type: string
      responses:
        '200':
          description: OK
        '404':
          $ref: '#/components/responses/NotFound'
        '409':
          description: Conflict
  /api/workflow/tasks/{taskId}/complete:
    post:
      summary: Complete workflow task
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: taskId
          required: true
          schema:
            type: string
      requestBody:
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                variables:
                  type: object
                formData:
                  type: object
      responses:
        '200':
          description: OK
  /api/workflow/message:
    post:
      summary: Send workflow message event
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                messageName:
                  type: string
                correlationKey:
                  type: string
                variables:
                  type: object
              required:
                - messageName
      responses:
        '200':
          description: OK
  /api/workflow/signal:
    post:
      summary: Broadcast workflow signal event
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                signalName:
                  type: string
                variables:
                  type: object
              required:
                - signalName
      responses:
        '200':
          description: OK
  /api/workflow/incidents:
    get:
      summary: List workflow incidents
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: state
          schema:
            type: string
        - in: query
          name: processInstanceId
          schema:
            type: string
      responses:
        '200':
          description: OK
  /api/workflow/incidents/{incidentId}/resolve:
    post:
      summary: Resolve workflow incident
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: incidentId
          required: true
          schema:
            type: string
      responses:
        '200':
          description: OK
  /api/workflow/audit:
    get:
      summary: Get workflow audit log
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: processInstanceId
          schema:
            type: string
        - in: query
          name: taskId
          schema:
            type: string
        - in: query
          name: userId
          schema:
            type: string
        - in: query
          name: from
          schema:
            type: string
            format: date-time
        - in: query
          name: to
          schema:
            type: string
            format: date-time
      responses:
        '200':
          description: OK
