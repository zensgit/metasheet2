paths:
  /api/permissions:
    get:
      summary: Get user permissions
      security: [ { bearerAuth: [] } ]
      parameters: [ { in: query, name: userId, schema: { type: string } } ]
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok: { type: boolean, example: true }
                  data:
                    type: object
                    properties:
                      userId: { type: string, example: u1 }
                      permissions:
                        type: array
                        items: { type: string }
              examples:
                sample:
                  value:
                    ok: true
                    data:
                      userId: u1
                      permissions:
                        - roles:read
                        - spreadsheets:write
        '400': { $ref: '#/components/responses/ValidationError' }
        '401': { $ref: '#/components/responses/Unauthorized' }
        '403': { $ref: '#/components/responses/Forbidden' }
        '404': { $ref: '#/components/responses/NotFound' }
  /api/permissions/grant:
    post:
      summary: Grant permission
      security: [ { bearerAuth: [] } ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                userId: { type: string }
                permission: { type: string }
              required: [userId, permission]
            examples:
              grant:
                value: { userId: u1, permission: roles:write }
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok: { type: boolean, example: true }
                  data:
                    type: object
                    properties:
                      userId: { type: string }
                      permissions:
                        type: array
                        items: { type: string }
        '400': { $ref: '#/components/responses/ValidationError' }
        '401': { $ref: '#/components/responses/Unauthorized' }
        '403': { $ref: '#/components/responses/Forbidden' }
        '404': { $ref: '#/components/responses/NotFound' }
  /api/permissions/revoke:
    post:
      summary: Revoke permission
      security: [ { bearerAuth: [] } ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                userId: { type: string }
                permission: { type: string }
              required: [userId, permission]
            examples:
              revoke:
                value: { userId: u1, permission: roles:write }
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                type: object
                properties:
                  ok: { type: boolean, example: true }
                  data:
                    type: object
                    properties:
                      userId: { type: string }
                      permissions:
                        type: array
                        items: { type: string }
        '400': { $ref: '#/components/responses/ValidationError' }
        '401': { $ref: '#/components/responses/Unauthorized' }
        '403': { $ref: '#/components/responses/Forbidden' }
        '404': { $ref: '#/components/responses/NotFound' }

  /api/permissions/cache-status:
    get:
      summary: Get permission cache status and metrics
      description: Returns cache size, TTL configuration, cache entries with timestamps, and hit/miss metrics for performance monitoring
      security: [ { bearerAuth: [] } ]
      responses:
        '200':
          description: Cache status with detailed metrics
          content:
            application/json:
              schema:
                type: object
                properties:
                  success: { type: boolean, example: true }
                  data:
                    type: object
                    properties:
                      cacheSize:
                        type: integer
                        example: 1
                        description: Number of cached entries
                      cacheTTL:
                        type: integer
                        example: 60000
                        description: Cache TTL in milliseconds
                      cacheEntries:
                        type: array
                        description: Detailed cache entry information
                        items:
                          type: object
                          properties:
                            key: { type: string, example: "permissions:u1" }
                            timestamp: { type: integer, example: 1758252866628 }
                            age: { type: integer, example: 21603, description: "Age in milliseconds" }
                            expired: { type: boolean, example: false }
                      metrics:
                        type: object
                        description: Cache hit/miss statistics
                        properties:
                          hits: { type: integer, example: 3, description: "Total cache hits" }
                          misses: { type: integer, example: 3, description: "Total cache misses" }
