# åˆ†æ”¯å·®å¼‚å¯¹æ¯”åˆ†ææŠ¥å‘Šï¼šci/v2-stabilize vs v2/init

## æ‰§è¡Œæ¦‚è¦
- **åˆ†ææ—¶é—´**: 2025-09-19 10:30
- **å¯¹æ¯”åˆ†æ”¯**: `ci/v2-stabilize` vs `v2/init`
- **å…±åŒç¥–å…ˆ**: af2cfb9 (Fix CI issues: update package-lock and fix workflow timeout handling)
- **åˆ†æèŒƒå›´**: ä»£ç å·®å¼‚ã€é…ç½®å†²çªã€åŠŸèƒ½å¯¹é½

## ğŸ¯ æ ¸å¿ƒå‘ç°

### åˆ†æ”¯å‘å±•æ–¹å‘å·®å¼‚
- **ci/v2-stabilize**: ä¸“æ³¨äºæ’ä»¶ç³»ç»Ÿå’Œå·¥ä½œæµå¼•æ“å¼€å‘
- **v2/init**: ä¸“æ³¨äºCI/CDåŸºç¡€è®¾æ–½å’ŒObservabilityå·¥ä½œæµ

## ğŸ“Š æäº¤å†å²å¯¹æ¯”

### ci/v2-stabilize åˆ†æ”¯ (é¢†å…ˆcommits)
```
b4598ea - feat(v2): implement P3-001 Workflow Engine Plugin
5df5db8 - feat(plugins): complete Phase 2 data processing plugins (P2-019, P2-020)
6e83cfb - feat(plugins): implement P2-016 to P2-018 data processing plugins
6000257 - docs: add comprehensive debugging and planning documentation
b574650 - docs: add session summary log (2025-09-18)
233e6e4 - ci: add migrations-dry-run job scaffold
083a4f9 - ci: remove legacy auth smoke (defer until v2 auth)
619aad1 - ci: seed + auth fallback in smoke jobs
8a51868 - fix: use direct SQL for CI admin user creation
4aeba24 - ci: invoke seed-ci-admin script in build-v2-core job
```

### v2/init åˆ†æ”¯ (é¢†å…ˆcommits)
```
4565075 - docs: Add final CI test reports and updated fix documentation
9ceda9a - optimize: Standardize workflow working directories and improve path handling
254567c - fix: Fix observability workflow directory context and paths
367a5fc - fix: Update smoke test scripts to make actual API calls for metrics validation
ff0d8a3 - feat: Implement complete Observability workflow
4b6fa1f - feat: Add CI validation scripts and reports
9659465 - fix: Add missing test configurations for metasheet-v2 packages
c3b1b19 - fix: Fix CI test failures
d1763ce - feat: Implement RPC timeout cleanup and error handling (fixes #27, #30)
349a228 - feat: Add permission denied metrics test enhancement (fixes #35)
```

## ğŸ”¥ å…³é”®å†²çªç‚¹åˆ†æ

### 1. GitHub Actions å·¥ä½œæµå†²çª âš ï¸

#### .github/workflows/observability.yml
| é¡¹ç›® | ci/v2-stabilize | v2/init | å†²çªçº§åˆ« |
|------|-----------------|----------|----------|
| **åç§°** | "Observability E2E" | "Observability" | ğŸŸ¡ è½»å¾® |
| **è§¦å‘è·¯å¾„** | `backend/src/**` | `metasheet-v2/**` | ğŸ”´ **ä¸¥é‡** |
| **PostgreSQLç‰ˆæœ¬** | postgres:15 | postgres:14 | ğŸŸ¡ è½»å¾® |
| **å·¥ä½œç›®å½•** | æ ¹ç›®å½• | `metasheet-v2/` | ğŸ”´ **ä¸¥é‡** |
| **ä»»åŠ¡èŒƒå›´** | backend E2Eæµ‹è¯• | å®Œæ•´Observabilityæµç¨‹ | ğŸ”´ **ä¸¥é‡** |

**å†²çªè¯´æ˜**: ä¸¤ä¸ªåˆ†æ”¯çš„Observabilityå·¥ä½œæµé’ˆå¯¹å®Œå…¨ä¸åŒçš„ç›®å½•ç»“æ„å’ŒåŠŸèƒ½èŒƒå›´ã€‚

#### .github/workflows/migration-replay.yml
- **ä¿®æ”¹ç±»å‹**: ä¸¤ä¸ªåˆ†æ”¯éƒ½æœ‰ä¿®æ”¹
- **å†²çªå¯èƒ½æ€§**: ğŸŸ¡ ä¸­ç­‰
- **éœ€è¦æ‰‹åŠ¨åˆå¹¶**: æ˜¯

### 2. ç›®å½•ç»“æ„æ ¹æœ¬æ€§å·®å¼‚ ğŸ”´

#### metasheet-v2/ ç›®å½•
- **ci/v2-stabilize**: âŒ ä¸å­˜åœ¨ metasheet-v2 ç›®å½•
- **v2/init**: âœ… å®Œæ•´çš„ metasheet-v2 é¡¹ç›®ç»“æ„

è¿™æ˜¯**æœ€å¤§çš„æ¶æ„å·®å¼‚**ï¼š
- `ci/v2-stabilize` ç»§ç»­åœ¨åŸ backend/ ç›®å½•å¼€å‘
- `v2/init` å»ºç«‹äº†å…¨æ–°çš„ metasheet-v2/ é¡¹ç›®ç»“æ„

### 3. åç«¯é…ç½®å†²çª ğŸŸ¡

#### backend/package.json
- **åŸºç¡€é…ç½®**: ä¸¤ä¸ªåˆ†æ”¯åŸºæœ¬ç›¸åŒ
- **è„šæœ¬å·®å¼‚**: å¯èƒ½å­˜åœ¨æ–°å¢è„šæœ¬çš„å†²çª
- **ä¾èµ–ç‰ˆæœ¬**: éœ€è¦æ£€æŸ¥ä¾èµ–ç‰ˆæœ¬å…¼å®¹æ€§

#### backend/jest.config.js
- **æµ‹è¯•é…ç½®**: ä¸¤ä¸ªåˆ†æ”¯éƒ½æœ‰ä¿®æ”¹
- **å†²çªé£é™©**: ğŸŸ¡ ä¸­ç­‰

## ğŸ“‹ åŠŸèƒ½å¯¹é½é¡¹åˆ†æ

### 1. Issueä¿®å¤å¯¹é½ âœ…

#### å…±åŒè§£å†³çš„Issues
- **Issue #27, #30**: RPC timeoutå’Œé”™è¯¯å¤„ç†
  - `ci/v2-stabilize`: åœ¨backend/ä¸­å®ç°
  - `v2/init`: åœ¨metasheet-v2/ä¸­å®ç°
  - **çŠ¶æ€**: é‡å¤å®ç°ï¼Œéœ€è¦é€‰æ‹©æˆ–åˆå¹¶

- **Issue #35**: æƒé™æ‹’ç»æŒ‡æ ‡
  - ä¸¤ä¸ªåˆ†æ”¯éƒ½æœ‰ç›¸å…³å®ç°
  - **çŠ¶æ€**: å¯èƒ½é‡å¤ï¼Œéœ€è¦å¯¹æ¯”

### 2. CI/CDåŸºç¡€è®¾æ–½ ğŸ”€

#### Observabilityå·¥ä½œæµ
- **ci/v2-stabilize**: ä¼ ç»Ÿbackend E2Eæµ‹è¯•
- **v2/init**: å®Œæ•´çš„OpenAPI + å¹¶å‘æµ‹è¯• + æŒ‡æ ‡éªŒè¯
- **å¯¹é½å»ºè®®**: v2/initçš„å®ç°æ›´å…¨é¢

#### æµ‹è¯•åŸºç¡€è®¾æ–½
- **ci/v2-stabilize**: ä¿æŒåŸæœ‰æµ‹è¯•ç»“æ„
- **v2/init**: æ–°å¢metasheet-v2æµ‹è¯•é…ç½®
- **å¯¹é½å»ºè®®**: å¯ä»¥å¹¶å­˜ï¼ŒæœåŠ¡ä¸åŒé¡¹ç›®

### 3. æ–‡æ¡£ä½“ç³» ğŸ“

#### æ–‡æ¡£æ–°å¢å¯¹æ¯”
| åˆ†ç±» | ci/v2-stabilize | v2/init | å»ºè®® |
|------|-----------------|----------|------|
| **æ’ä»¶å¼€å‘** | PLUGIN_*.md | - | ä¿ç•™ |
| **æ¶æ„é‡æ„** | ARCHITECTURE_*.md | - | ä¿ç•™ |
| **CIä¿®å¤** | - | CI_FIX_*.md | ä¿ç•™ |
| **å·¥ä½œæµä¼˜åŒ–** | - | WORKFLOW_*.md | ä¿ç•™ |

## ğŸš§ æ½œåœ¨å†²çªç‚¹è¯¦ç»†åˆ†æ

### 1. é«˜é£é™©å†²çª ğŸ”´

#### å·¥ä½œæµè·¯å¾„å†²çª
```yaml
# ci/v2-stabilize
paths:
  - 'backend/src/**'
  - 'backend/scripts/**'

# v2/init
paths:
  - 'metasheet-v2/**'
```
**è§£å†³æ–¹æ¡ˆ**: éœ€è¦å†³å®šæ˜¯å¦æ”¯æŒä¸¤å¥—å¹¶è¡Œçš„é¡¹ç›®ç»“æ„

#### PostgreSQLç‰ˆæœ¬å†²çª
- `ci/v2-stabilize`: postgres:15
- `v2/init`: postgres:14
**è§£å†³æ–¹æ¡ˆ**: ç»Ÿä¸€åˆ°postgres:15æˆ–æµ‹è¯•å…¼å®¹æ€§

### 2. ä¸­ç­‰é£é™©å†²çª ğŸŸ¡

#### åŒ…ç®¡ç†æ–‡ä»¶
- `backend/package.json`: ä¸¤ä¸ªåˆ†æ”¯éƒ½æœ‰ä¿®æ”¹
- `pnpm-lock.yaml`: å¯èƒ½æœ‰ä¾èµ–ç‰ˆæœ¬å†²çª
**è§£å†³æ–¹æ¡ˆ**: éœ€è¦ä»”ç»†åˆå¹¶ä¾èµ–å˜æ›´

#### Jesté…ç½®
- æµ‹è¯•è·¯å¾„é…ç½®å¯èƒ½å†²çª
- æ¨¡å—è§£æç­–ç•¥å¯èƒ½ä¸åŒ
**è§£å†³æ–¹æ¡ˆ**: ä¿æŒå‘åå…¼å®¹çš„é…ç½®

### 3. ä½é£é™©å†²çª ğŸŸ¢

#### æ–‡æ¡£æ–‡ä»¶
- å¤§éƒ¨åˆ†æ˜¯æ–°å¢æ–‡ä»¶ï¼Œå†²çªæ¦‚ç‡ä½
- README.mdå¯èƒ½æœ‰è½»å¾®å†²çª
**è§£å†³æ–¹æ¡ˆ**: åˆå¹¶æ—¶ä¿ç•™æ‰€æœ‰æœ‰ä»·å€¼çš„æ–‡æ¡£

## ğŸ¯ åˆå¹¶ç­–ç•¥å»ºè®®

### 1. ç«‹å³åˆå¹¶é¡¹ âœ…
- **æ–‡æ¡£æ–‡ä»¶**: æ‰€æœ‰.mdæ–‡æ¡£æ–‡ä»¶å¯ä»¥ç›´æ¥åˆå¹¶
- **æ–°å¢è„šæœ¬**: ci/v2-stabilizeçš„æ–°å¢è„šæœ¬
- **æ’ä»¶ç³»ç»Ÿ**: ci/v2-stabilizeçš„æ’ä»¶å¼€å‘å†…å®¹

### 2. éœ€è¦åè°ƒçš„é¡¹ âš ï¸
- **Observabilityå·¥ä½œæµ**: éœ€è¦å†³å®šä¿ç•™å“ªä¸ªç‰ˆæœ¬æˆ–åˆå¹¶
- **PostgreSQLç‰ˆæœ¬**: ç»Ÿä¸€æ•°æ®åº“ç‰ˆæœ¬
- **æµ‹è¯•é…ç½®**: ç¡®ä¿æµ‹è¯•é…ç½®å…¼å®¹

### 3. æ¶æ„å†³ç­–é¡¹ ğŸ”´
- **é¡¹ç›®ç»“æ„**: æ˜¯å¦ä¿ç•™metasheet-v2/ç›®å½•ï¼Ÿ
- **å¼€å‘é‡ç‚¹**: ç»§ç»­backend/å¼€å‘è¿˜æ˜¯è½¬å‘metasheet-v2/ï¼Ÿ
- **CIç­–ç•¥**: æ”¯æŒå•ä¸€ç»“æ„è¿˜æ˜¯åŒè½¨å¹¶è¡Œï¼Ÿ

## ğŸ“ˆ åˆå¹¶å¤æ‚åº¦è¯„ä¼°

### æ–‡ä»¶å˜æ›´ç»Ÿè®¡
- **æ–°å¢æ–‡ä»¶**: ~100+ (ä¸»è¦æ˜¯v2/initçš„metasheet-v2/å†…å®¹)
- **ä¿®æ”¹æ–‡ä»¶**: ~20 (å·¥ä½œæµã€é…ç½®ã€è„šæœ¬)
- **æ½œåœ¨å†²çª**: ~8-10ä¸ªæ–‡ä»¶
- **è‡ªåŠ¨åˆå¹¶ç‡**: ~85%

### åˆå¹¶å·¥ä½œé‡é¢„ä¼°
- **ç®€å•åˆå¹¶**: 2-3å°æ—¶
- **å†²çªè§£å†³**: 4-6å°æ—¶
- **æµ‹è¯•éªŒè¯**: 2-3å°æ—¶
- **æ€»è®¡**: 8-12å°æ—¶

## ğŸ”„ æ¨èåˆå¹¶æ­¥éª¤

### Phase 1: å®‰å…¨åˆå¹¶ (2å°æ—¶)
1. åˆå¹¶æ‰€æœ‰æ–‡æ¡£æ–‡ä»¶
2. åˆå¹¶æ–°å¢çš„è„šæœ¬å’Œå·¥å…·
3. åˆå¹¶ä¸å†²çªçš„åŠŸèƒ½å®ç°

### Phase 2: å†²çªè§£å†³ (4-6å°æ—¶)
1. è§£å†³å·¥ä½œæµæ–‡ä»¶å†²çª
2. ç»Ÿä¸€PostgreSQLå’Œä¾èµ–ç‰ˆæœ¬
3. åˆå¹¶backendé…ç½®å˜æ›´

### Phase 3: æ¶æ„æ•´åˆ (2-4å°æ—¶)
1. å†³å®šé¡¹ç›®ç»“æ„ç­–ç•¥
2. ç»Ÿä¸€CI/CDå·¥ä½œæµ
3. éªŒè¯åŠŸèƒ½å®Œæ•´æ€§

### Phase 4: æµ‹è¯•éªŒè¯ (2-3å°æ—¶)
1. è¿è¡Œæ‰€æœ‰CIå·¥ä½œæµ
2. éªŒè¯åŠŸèƒ½ä¸å†²çª
3. æ›´æ–°æ–‡æ¡£å’Œè¯´æ˜

## ğŸª ç‰¹æ®Šè€ƒè™‘äº‹é¡¹

### 1. å‘åå…¼å®¹æ€§
- ç¡®ä¿ci/v2-stabilizeçš„æ’ä»¶åŠŸèƒ½ä¸å—å½±å“
- ä¿æŒv2/initçš„CIæ”¹è¿›

### 2. å¼€å‘ç»§ç»­æ€§
- ä¸¤ä¸ªåˆ†æ”¯ä»£è¡¨ä¸åŒçš„å¼€å‘é‡ç‚¹
- å¯èƒ½éœ€è¦å¹¶è¡Œç»´æŠ¤ä¸€æ®µæ—¶é—´

### 3. å›¢é˜Ÿåè°ƒ
- éœ€è¦æ˜ç¡®å„åˆ†æ”¯çš„ç»´æŠ¤è´£ä»»
- ç»Ÿä¸€å¼€å‘å’Œéƒ¨ç½²ç­–ç•¥

## ğŸ“ è¡ŒåŠ¨å»ºè®®

### å³æ—¶è¡ŒåŠ¨ (ä»Šå¤©)
1. **æ¶æ„å†³ç­–**: ç¡®å®šæ˜¯å¦ä¿ç•™metasheet-v2/ç»“æ„
2. **ä¼˜å…ˆçº§ç¡®è®¤**: ç¡®å®šci/v2-stabilize vs v2/initçš„ä¼˜å…ˆçº§
3. **åˆå¹¶è®¡åˆ’**: åˆ¶å®šè¯¦ç»†çš„åˆå¹¶æ—¶é—´è¡¨

### çŸ­æœŸè¡ŒåŠ¨ (æœ¬å‘¨)
1. **æ‰§è¡Œåˆå¹¶**: æŒ‰é˜¶æ®µæ‰§è¡Œåˆå¹¶æ“ä½œ
2. **CIéªŒè¯**: ç¡®ä¿æ‰€æœ‰å·¥ä½œæµæ­£å¸¸
3. **æ–‡æ¡£æ•´ç†**: ç»Ÿä¸€å’Œæ›´æ–°é¡¹ç›®æ–‡æ¡£

### ä¸­æœŸè¡ŒåŠ¨ (ä¸‹å‘¨)
1. **åŠŸèƒ½æµ‹è¯•**: å…¨é¢æµ‹è¯•åˆå¹¶åçš„åŠŸèƒ½
2. **æ€§èƒ½éªŒè¯**: ç¡®ä¿æ€§èƒ½æ²¡æœ‰å›é€€
3. **å›¢é˜ŸåŸ¹è®­**: æ›´æ–°å›¢é˜Ÿå¯¹æ–°ç»“æ„çš„äº†è§£

---
*åˆ†ææŠ¥å‘Šç”Ÿæˆè€…: Claude Assistant*
*åˆ†ææ—¶é—´: 2025-09-19 10:30*
*å»ºè®®ä¼˜å…ˆçº§: ğŸ”´ é«˜ä¼˜å…ˆçº§ - éœ€è¦ç«‹å³å¤„ç†æ¶æ„åˆ†æ­§*