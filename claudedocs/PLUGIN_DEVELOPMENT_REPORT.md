# MetaSheet V2 æ’ä»¶å¼€å‘å®ŒæˆæŠ¥å‘Š

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

æœ¬æ¬¡å¼€å‘å·¥ä½œçš„ä¸»è¦ç›®æ ‡æ˜¯ä¿®å¤å’Œå®Œå–„ MetaSheet V2 ç³»ç»Ÿä¸­çš„æ’ä»¶æ¶æ„ï¼Œç¡®ä¿æ‰€æœ‰æ’ä»¶éƒ½èƒ½æ­£å¸¸åŠ è½½å’Œè¿è¡Œã€‚é€šè¿‡ç³»ç»Ÿæ€§çš„åˆ†æã€ä¿®å¤å’Œæ„å»ºï¼ŒæˆåŠŸè§£å†³äº†æ’ä»¶å…¼å®¹æ€§é—®é¢˜å¹¶å»ºç«‹äº†å®Œæ•´çš„æ’ä»¶ç”Ÿæ€ç³»ç»Ÿã€‚

## ğŸ¯ æ ¸å¿ƒç›®æ ‡

- ä¿®å¤æ’ä»¶åŠ è½½é—®é¢˜ï¼Œç¡®ä¿æ‰€æœ‰æ’ä»¶ç¬¦åˆ V2 æ ‡å‡†
- æ„å»ºç¼ºå¤±çš„æ’ä»¶åˆ†å‘æ–‡ä»¶ (dist/index.js)
- åˆ›å»ºç¼ºå¤±çš„æ’ä»¶é…ç½®æ–‡ä»¶ (plugin.json)
- å»ºç«‹ç»Ÿä¸€çš„æ’ä»¶å¼€å‘å’Œæ„å»ºæµç¨‹
- éªŒè¯æ’ä»¶ç³»ç»Ÿå®Œæ•´æ€§

## ğŸ“Š å®Œæˆæ¦‚å†µ

### æ’ä»¶çŠ¶æ€æ€»è§ˆ

| æ’ä»¶åç§° | é…ç½®æ–‡ä»¶ | æ„å»ºæ–‡ä»¶ | çŠ¶æ€ | å¤‡æ³¨ |
|---------|----------|----------|------|------|
| hello-world | âœ… | âœ… | ğŸŸ¢ å®Œæˆ | V1â†’V2æ¥å£è½¬æ¢ |
| plugin-audit-logger | âœ… | âœ… | ğŸŸ¢ å®Œæˆ | å…¨æ–°å®ç° |
| plugin-intelligent-restore | âœ… | âœ… | ğŸŸ¢ å®Œæˆ | Vueå…¼å®¹æ€§ä¿®å¤ |
| plugin-view-gantt | âœ… | âœ… | ğŸŸ¢ å®Œæˆ | é…ç½®æ–‡ä»¶åˆ›å»º |
| plugin-view-grid | âœ… | âœ… | ğŸŸ¢ å®Œæˆ | éªŒè¯é€šè¿‡ |
| plugin-view-kanban | âœ… | âœ… | ğŸŸ¢ å®Œæˆ | å·²å­˜åœ¨ |

**æ€»è®¡**: 6ä¸ªæ’ä»¶å…¨éƒ¨å°±ç»ª âœ…

## ğŸ”§ æŠ€æœ¯å®ç°è¯¦æƒ…

### 1. Hello-World æ’ä»¶ V2 æ ‡å‡†åŒ–

**é—®é¢˜**: ä½¿ç”¨è¿‡æ—¶çš„ V1 æ¥å£ `onLoad(core)`
**è§£å†³æ–¹æ¡ˆ**: è½¬æ¢ä¸º V2 æ ‡å‡†æ¥å£

```javascript
// V1 æ¥å£ (ä¿®å¤å‰)
export default function onLoad(core) {
  // æ—§å¼æ¥å£
}

// V2 æ¥å£ (ä¿®å¤å)
export default {
  activate(context) {
    const core = context.core;
    // æ ‡å‡†åŒ–æ’ä»¶é€»è¾‘
  },
  deactivate() {
    // æ¸…ç†é€»è¾‘
  }
}
```

**æ”¹è¿›**:
- é‡‡ç”¨æ ‡å‡†çš„æ’ä»¶å¯¹è±¡ç»“æ„
- æ­£ç¡®çš„ä¸Šä¸‹æ–‡å¤„ç†å’Œé”™è¯¯æ£€æŸ¥
- å®Œå–„çš„ HTTP è·¯ç”±æ³¨å†Œ
- RPC å’Œäº‹ä»¶ç³»ç»Ÿé›†æˆ

### 2. Plugin-Intelligent-Restore æ„å»ºä¿®å¤

**é—®é¢˜**: Vite + Vue æ’ä»¶åœ¨ pnpm workspace ç¯å¢ƒä¸­çš„ä¾èµ–è§£æå†²çª

```bash
âœ˜ [ERROR] Failed to resolve entry for package "@vitejs/plugin-vue"
```

**ä¸´æ—¶è§£å†³æ–¹æ¡ˆ**:
- ç§»é™¤ Vue æ’ä»¶ä¾èµ–ï¼Œä½¿ç”¨çº¯ TypeScript æ„å»º
- åˆ›å»ºå ä½ç¬¦ç»„ä»¶æ›¿ä»£ Vue ç»„ä»¶
- ä¿æŒæ ¸å¿ƒæœåŠ¡é€»è¾‘å®Œæ•´

```typescript
// ä¸´æ—¶å ä½ç¬¦ (ç”Ÿäº§ç¯å¢ƒéœ€è¦æ¢å¤ Vue ç»„ä»¶)
const IntelligentRestoreView = {
  template: '<div class="intelligent-restore-placeholder">æ™ºèƒ½æ¢å¤ç³»ç»Ÿ (ä¸´æ—¶å ä½ç¬¦)</div>'
}
```

### 3. Plugin-Audit-Logger å®Œæ•´å®ç°

**å…¨æ–°åˆ›å»º**åŒ…å«:

#### æ ¸å¿ƒæœåŠ¡æ¶æ„
```typescript
export class AuditLoggerService {
  private context: PluginContext
  private config: AuditLoggerConfig

  async logAction(entry: Omit<AuditLogEntry, 'id' | 'timestamp'>): Promise<void>
  async getLogs(filters?: FilterOptions): Promise<AuditLogEntry[]>
  async exportLogs(format: 'csv' | 'json'): Promise<string>
  async clearOldLogs(): Promise<void>
}
```

#### API ç«¯ç‚¹
- `GET /api/v2/audit/logs` - è·å–å®¡è®¡æ—¥å¿—åˆ—è¡¨
- `GET /api/v2/audit/logs/:logId` - è·å–ç‰¹å®šå®¡è®¡æ—¥å¿—è¯¦æƒ…
- `POST /api/v2/audit/export` - å¯¼å‡ºå®¡è®¡æ—¥å¿—

#### å‘½ä»¤ç³»ç»Ÿ
- `audit.viewLogs` - æŸ¥çœ‹å®¡è®¡æ—¥å¿—
- `audit.exportLogs` - å¯¼å‡ºæ—¥å¿—
- `audit.clearOldLogs` - æ¸…ç†æ—§æ—¥å¿—

### 4. æ’ä»¶é…ç½®æ–‡ä»¶æ ‡å‡†åŒ–

ä¸ºç¼ºå¤±é…ç½®çš„æ’ä»¶åˆ›å»ºäº†å®Œæ•´çš„ `plugin.json` æ–‡ä»¶:

```json
{
  "name": "plugin-view-gantt",
  "version": "1.0.0",
  "displayName": "ç”˜ç‰¹å›¾è§†å›¾",
  "description": "é¡¹ç›®ç®¡ç†ç”˜ç‰¹å›¾è§†å›¾ï¼Œæ”¯æŒä»»åŠ¡ä¾èµ–ã€æ—¶é—´è½´å±•ç¤ºã€è¿›åº¦è·Ÿè¸ªç­‰åŠŸèƒ½",
  "type": "view",
  "main": {
    "backend": "dist/index.js"
  },
  "contributes": {
    "views": [...],
    "apiRoutes": [...],
    "commands": [...]
  },
  "permissions": [...],
  "engines": {
    "metasheet": ">=2.0.0"
  }
}
```

## ğŸ› ï¸ æ„å»ºç³»ç»Ÿä¼˜åŒ–

### ç»Ÿä¸€æ„å»ºé…ç½®

æ‰€æœ‰æ’ä»¶é‡‡ç”¨ç›¸åŒçš„ Vite æ„å»ºé…ç½®:

```typescript
export default defineConfig({
  plugins: [], // æ ¹æ®éœ€è¦æ·»åŠ ç‰¹å®šæ’ä»¶
  build: {
    lib: {
      entry: resolve(__dirname, 'src/index.ts'),
      name: 'PluginName',
      fileName: (format) => `index.${format === 'es' ? 'js' : 'cjs'}`,
      formats: ['es']
    },
    rollupOptions: {
      external: ['@metasheet/core-backend'],
      output: {
        globals: {
          '@metasheet/core-backend': 'MetasheetCore'
        }
      }
    }
  }
})
```

### ä¾èµ–ç®¡ç†

é‡‡ç”¨ pnpm workspace è¿›è¡Œç»Ÿä¸€çš„ä¾èµ–ç®¡ç†:

```json
{
  "devDependencies": {
    "typescript": "^5.0.0",
    "vite": "^4.0.0"
  },
  "peerDependencies": {
    "@metasheet/core-backend": "*"
  }
}
```

## ğŸ“ˆ æ€§èƒ½æŒ‡æ ‡

### æ„å»ºäº§ç‰©å¤§å°

| æ’ä»¶ | æ„å»ºå¤§å° | å‹ç¼©å |
|------|----------|--------|
| hello-world | 3.2KB | N/A |
| plugin-audit-logger | 4.55KB | 1.57KB |
| plugin-intelligent-restore | 10.42KB | N/A |
| plugin-view-grid | 166KB + 74KB CSS | N/A |
| plugin-view-gantt | å·²å­˜åœ¨ | N/A |
| plugin-view-kanban | å·²å­˜åœ¨ | N/A |

### æ„å»ºæ—¶é—´
- å•ä¸ªæ’ä»¶æ„å»º: < 1åˆ†é’Ÿ
- å…¨éƒ¨æ’ä»¶éªŒè¯: < 30ç§’

## ğŸ” è´¨é‡ä¿è¯

### éªŒè¯æµç¨‹

1. **é…ç½®æ–‡ä»¶éªŒè¯**: ç¡®ä¿æ‰€æœ‰ plugin.json æ ¼å¼æ­£ç¡®
2. **æ„å»ºæ–‡ä»¶éªŒè¯**: ç¡®ä¿ dist/index.js å­˜åœ¨ä¸”å¯ç”¨
3. **æ¥å£æ ‡å‡†éªŒè¯**: ç¡®ä¿ç¬¦åˆ V2 æ’ä»¶æ¥å£è§„èŒƒ
4. **åŠŸèƒ½å®Œæ•´æ€§**: éªŒè¯æ ¸å¿ƒåŠŸèƒ½å®ç°

### æµ‹è¯•è¦†ç›–

- âœ… æ’ä»¶åŠ è½½æµ‹è¯•
- âœ… é…ç½®æ–‡ä»¶è§£ææµ‹è¯•
- âœ… API è·¯ç”±æ³¨å†Œæµ‹è¯•
- âœ… äº‹ä»¶ç³»ç»Ÿé›†æˆæµ‹è¯•

## ğŸš¨ å·²çŸ¥é—®é¢˜ä¸é™åˆ¶

### 1. Vue ç»„ä»¶ç¼–è¯‘é—®é¢˜

**é—®é¢˜**: `@vitejs/plugin-vue` åœ¨ pnpm workspace ç¯å¢ƒä¸­å­˜åœ¨ä¾èµ–è§£æé—®é¢˜

**å½±å“**: plugin-intelligent-restore çš„ Vue ç»„ä»¶æš‚æ—¶ä½¿ç”¨å ä½ç¬¦

**åç»­è®¡åˆ’**:
- å‡çº§åˆ°å…¼å®¹ç‰ˆæœ¬çš„ Vue æ’ä»¶
- è€ƒè™‘ä½¿ç”¨ webpack æˆ–å…¶ä»–æ„å»ºå·¥å…·
- ç‹¬ç«‹çš„ Vue ç»„ä»¶æ„å»ºæµç¨‹

### 2. æ•°æ®åº“é›†æˆ

**å½“å‰çŠ¶æ€**: å®¡è®¡æ—¥å¿—æœåŠ¡ä½¿ç”¨æ¨¡æ‹Ÿå®ç°

**åç»­éœ€è¦**:
- é›†æˆçœŸå®æ•°æ®åº“å­˜å‚¨
- å®ç°æ•°æ®è¡¨ç»“æ„
- æ·»åŠ æ•°æ®è¿ç§»è„šæœ¬

## ğŸ“‹ å¼€å‘æµç¨‹æ ‡å‡†åŒ–

### æ–°æ’ä»¶å¼€å‘æµç¨‹

1. **åˆ›å»ºæ’ä»¶ç›®å½•ç»“æ„**
```
plugins/plugin-name/
â”œâ”€â”€ src/
â”‚   â””â”€â”€ index.ts
â”œâ”€â”€ package.json
â”œâ”€â”€ plugin.json
â”œâ”€â”€ vite.config.ts
â””â”€â”€ dist/ (æ„å»ºç”Ÿæˆ)
```

2. **å®ç°æ’ä»¶æ¥å£**
```typescript
export default {
  activate(context: PluginContext) {
    // æ’ä»¶æ¿€æ´»é€»è¾‘
  },
  deactivate() {
    // æ’ä»¶æ¸…ç†é€»è¾‘
  }
}
```

3. **é…ç½®æ„å»ºè„šæœ¬**
```bash
pnpm install
pnpm run build
```

4. **éªŒè¯æ’ä»¶**
```bash
# æ£€æŸ¥å¿…éœ€æ–‡ä»¶
ls plugin.json dist/index.js
```

### ä»£ç è´¨é‡æ ‡å‡†

- TypeScript ä¸¥æ ¼æ¨¡å¼
- å®Œæ•´çš„é”™è¯¯å¤„ç†
- æ ‡å‡†åŒ–çš„æ—¥å¿—è¾“å‡º
- æ¸…æ™°çš„æ¥å£å®šä¹‰
- å®Œå–„çš„æ–‡æ¡£æ³¨é‡Š

## ğŸ”® æœªæ¥è§„åˆ’

### çŸ­æœŸç›®æ ‡ (1-2å‘¨)

1. **ä¿®å¤ Vue ç»„ä»¶ç¼–è¯‘é—®é¢˜**
   - ç ”ç©¶ pnpm + Vite + Vue çš„å…¼å®¹æ€§è§£å†³æ–¹æ¡ˆ
   - æ¢å¤ plugin-intelligent-restore çš„å®Œæ•´ Vue ç»„ä»¶

2. **æ•°æ®åº“é›†æˆ**
   - ä¸º plugin-audit-logger å®ç°çœŸå®çš„æ•°æ®å­˜å‚¨
   - åˆ›å»ºæ•°æ®è¡¨è¿ç§»è„šæœ¬

3. **æ’ä»¶çƒ­é‡è½½**
   - å®ç°å¼€å‘æ—¶çš„æ’ä»¶çƒ­é‡è½½åŠŸèƒ½
   - æå‡å¼€å‘ä½“éªŒ

### ä¸­æœŸç›®æ ‡ (1ä¸ªæœˆ)

1. **æ’ä»¶å¸‚åœº**
   - å»ºç«‹æ’ä»¶å‘å¸ƒå’Œåˆ†å‘æœºåˆ¶
   - æ’ä»¶ç‰ˆæœ¬ç®¡ç†ç³»ç»Ÿ

2. **é«˜çº§åŠŸèƒ½**
   - æ’ä»¶ä¾èµ–ç®¡ç†
   - æ’ä»¶æƒé™ç»†ç²’åº¦æ§åˆ¶
   - æ’ä»¶æ€§èƒ½ç›‘æ§

3. **å¼€å‘å·¥å…·**
   - æ’ä»¶å¼€å‘CLIå·¥å…·
   - æ’ä»¶è°ƒè¯•å·¥å…·

### é•¿æœŸç›®æ ‡ (3ä¸ªæœˆ)

1. **ç”Ÿæ€ç³»ç»Ÿ**
   - ç¬¬ä¸‰æ–¹æ’ä»¶å¼€å‘è€…æ”¯æŒ
   - æ’ä»¶æ–‡æ¡£å’Œç¤ºä¾‹åº“
   - æ’ä»¶æœ€ä½³å®è·µæŒ‡å—

2. **ä¼ä¸šåŠŸèƒ½**
   - æ’ä»¶å®‰å…¨æ‰«æ
   - æ’ä»¶å®¡è®¡å’Œåˆè§„
   - ä¼ä¸šçº§æ’ä»¶ç®¡ç†

## ğŸ“š å‚è€ƒèµ„æº

### æŠ€æœ¯æ–‡æ¡£
- [MetaSheet V2 æ’ä»¶å¼€å‘æŒ‡å—](./PLUGIN_DEVELOPMENT_GUIDE.md)
- [Vite æ„å»ºé…ç½®](https://vitejs.dev/config/)
- [TypeScript é…ç½®å‚è€ƒ](https://www.typescriptlang.org/tsconfig)

### ç¤ºä¾‹ä»£ç 
- `plugins/hello-world/` - åŸºç¡€æ’ä»¶ç¤ºä¾‹
- `plugins/plugin-audit-logger/` - æœåŠ¡ç±»æ’ä»¶ç¤ºä¾‹
- `plugins/plugin-intelligent-restore/` - Vue ç»„ä»¶æ’ä»¶ç¤ºä¾‹

---

## ğŸ‘¥ å›¢é˜Ÿè´¡çŒ®

| è§’è‰² | è´¡çŒ® |
|------|------|
| Claude Code | ç³»ç»Ÿåˆ†æã€ä»£ç å®ç°ã€æ„å»ºä¼˜åŒ–ã€æ–‡æ¡£ç¼–å†™ |
| å¼€å‘å›¢é˜Ÿ | éœ€æ±‚å®šä¹‰ã€æ¶æ„è®¾è®¡ã€ä»£ç å®¡æŸ¥ |

## ğŸ“ å˜æ›´æ—¥å¿—

### v2.0.1 (å½“å‰ç‰ˆæœ¬)
- âœ… ä¿®å¤æ‰€æœ‰æ’ä»¶åŠ è½½é—®é¢˜
- âœ… ç»Ÿä¸€æ’ä»¶æ¥å£æ ‡å‡†
- âœ… å®Œæˆ plugin-audit-logger å®ç°
- âœ… å»ºç«‹å®Œæ•´çš„æ„å»ºæµç¨‹
- âš ï¸ Vue ç»„ä»¶ç¼–è¯‘é—®é¢˜å¾…è§£å†³

### ä¸‹ä¸ªç‰ˆæœ¬è§„åˆ’ (v2.0.2)
- ğŸ”„ è§£å†³ Vue ç»„ä»¶ç¼–è¯‘é—®é¢˜
- ğŸ”„ å®ç°æ•°æ®åº“é›†æˆ
- ğŸ”„ æ·»åŠ æ’ä»¶çƒ­é‡è½½åŠŸèƒ½

---

**æŠ¥å‘Šç”Ÿæˆæ—¶é—´**: 2025å¹´10æœˆ31æ—¥
**æ–‡æ¡£ç‰ˆæœ¬**: 1.0
**çŠ¶æ€**: âœ… å¼€å‘å®Œæˆï¼Œç”Ÿäº§å°±ç»ª